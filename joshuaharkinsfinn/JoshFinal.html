<!DOCTYPE html>
<html>
    <head>
        <title>Day 78</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>

        <script>

            aidansong =
                    [[987.8, 266.6],
                        [830.6, 266.6],
                        [740, 266.6],
                        [659.3, 266.6],
                        [740, 266.6],
                        [830.6, 266.6],
                        [987.8, 133.3]
                    ];
            note0 =
                    [[50, 100]
                    ];
            note1 =
                    [[100, 100]
                    ];
            note2 =
                    [[200, 100]
                    ];
            note3 =
                    [[300, 100]
                    ];
            note4 =
                    [[400, 100]
                    ];
            note5 =
                    [[500, 100]
                    ];
            note6 =
                    [[600, 100]
                    ];
            note7 =
                    [[700, 100]
                    ];
            note8 =
                    [[800, 100]
                    ];
            note9 =
                    [[900, 100]
                    ];
            note10 =
                    [[1000, 100]
                    ];
            note11 =
                    [[1100, 100]
                    ];
            note12 =
                    [[1200, 100]
                    ];
            note13 =
                    [[1300, 100]
                    ];

            $(document).ready(function() {
                var socket = io.connect('http://10.48.102.136:3001');


                $("#turnOneSec").click(function(e) {
                    console.log("turn90");
                    speed = $("#speed").text();
                    if (speed < 10) {
                        speed = 50;
                        $("#speed").text(50);
                    }
                    socket.emit('drive', {left: speed, right: -speed});
                    setTimeout(function() {
                        socket.emit('drive', {left: speed, right: speed});
                    }, 1000);
                });
                
                $("#goalKeep").click(function(e) {
                    console.log("goalkeep");
                    socket.emit('drive', {left: 500, right: 500});
                    setTimeout(function() {
                        socket.emit('drive', {left: -500, right: -500});
                    }, 2000);
                    setTimeout(function() {
                        socket.emit('drive', {left: 500, right: 500});
                    }, 2000);
                });

                function followline(data) {
                    speed = $("#speed").text();
                    if (speed < 10)
                        return;
                    front_left = data.cliff_sensors.front_left.signal.raw;
                    front_right = data.cliff_sensors.front_right.signal.raw;
                    if (Math.abs(front_left - front_right) < 100) {
                        socket.emit('drive', {left: speed, right: speed});
                        return;
                    }
                    ;

                    if (Math.abs(front_left < front_right)) {
                        socket.emit('drive', {left: speed * .5, right: speed});
                    }
                    ;
                    if (Math.abs(front_left > front_right)) {
                        socket.emit('drive', {left: speed, right: speed * .5});
                    }
                    ;
                }



                socket.on('sensordata', function(data) {
                    //console.log(data);
                    $("#voltage").text(data.battery.voltage.volts);
                    $("#left").text(data.cliff_sensors.left.signal.raw);
                    $("#front_left").text(data.cliff_sensors.front_left.signal.raw);
                    $("#front_right").text(data.cliff_sensors.front_right.signal.raw);
                    $("#right").text(data.cliff_sensors.right.signal.raw);
                    //$("#allsensors").text(JSON.stringify(data));
                    if ($('#followline').is(':checked')) {
                        followline(data);
                    }
                    ;
                    socket.emit('sensorswritten');
                });


                $("#forward").click(function(e) {
                    console.log('forward');
                    socket.emit('drive', {left: 15, right: 15});
                });

                $("#halt").click(function(e) {
                    console.log('halt');
                    socket.emit('drive', {left: 0, right: 0});
                });

                $("#aidan").click(function(e) {
                    socket.emit('sing', aidansong);
                });

                if (event.which === 49) {
                    socket.emit('sing', note1);
                    console.log('note1');
                }
                ;
                if (event.which === 50) {
                    socket.emit('sing', note2);
                }
                ;
                if (event.which === 51) {
                    socket.emit('sing', note3);
                }
                ;

                $("#safeMode").click(function(e) {
                    socket.emit('safeMode');
                });

                $("#fullMode").click(function(e) {
                    socket.emit('fullMode');
                });


                $('body').keydown(function(event) {
                    console.log(event.which);
                    speed = $("#speed").text();
                    //speed = 100;
                    if (event.which === 87) //w - move forward
                    {
                        speed = $("#speed").text();
                        speed = speed * 1 + 50;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: speed, right: speed});
                    }

                    if (event.which === 83) //s - move backward
                    {
                        speed = $("#speed").text();
                        speed = speed * 1 - 50;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: speed, right: speed});
                    }

                    if (event.which === 65) //d - move right
                    {
                        speed = $("#speed").text();
                        speed = 50;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: speed, right: -speed});

                    }

                    if (event.which === 68) //a - move left
                    {
                        speed = $("#speed").text();
                        speed = 50;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: -speed, right: speed});
                    }
                    if (event.which === 192) {
                        socket.emit('sing', note0);
                        //console.log('note0');
                    }
                    if (event.which === 49) {
                        socket.emit('sing', note1);
                        //console.log('note1');
                    }
                    ;
                    if (event.which === 50) {
                        socket.emit('sing', note2);
                    }
                    ;
                    if (event.which === 51) {
                        socket.emit('sing', note3);
                    }
                    ;
                    if (event.which === 52) {
                        socket.emit('sing', note4);
                        //console.log('note4');
                    }
                    ;
                    if (event.which === 53) {
                        socket.emit('sing', note5);
                    }
                    ;
                    if (event.which === 54) {
                        socket.emit('sing', note6);
                    }
                    ;
                    if (event.which === 55) {
                        socket.emit('sing', note7);
                        //console.log('note0');
                    }
                    if (event.which === 56) {
                        socket.emit('sing', note8);
                        //console.log('note1');
                    }
                    ;
                    if (event.which === 57) {
                        socket.emit('sing', note9);
                    }
                    ;
                    if (event.which === 48) {
                        socket.emit('sing', note10);
                    }
                    ;
                    if (event.which === 189) {
                        socket.emit('sing', note11);
                        //console.log('note4');
                    }
                    ;
                    if (event.which === 187) {
                        socket.emit('sing', note12);
                    }
                    ;
                    if (event.which === 8) {
                        socket.emit('sing', note13);
                    }
                    ;

                    if (event.which === 32) //space - stop

                    {
                        speed = $("#speed").text();
                        speed = 0;
                        $("#speed").text(speed);
                        socket.emit('drive', {left: speed, right: speed});
                        event.preventDefault();
                    }
                });

            });
        </script>

    </head>
    <body>
        <div class="container">
            <div class="row">
                <button id="forward">forward</button>
                <button id="halt">halt</button>
                <button id="aidan">song</button>
                <button id="safeMode">safeMode</button>
                <button id="fullMode">fullMode</button>
                <button id="turnOneSec">turnOneSec</button>
                <button id="goalKeep">goalKeep</button>
                Voltage  <span id="voltage">...</span>

            </div>
            <div>speed:<span id="speed">100</span></div>
            <div>left  <span id="left">...</span>
                front_left  <span id="front_left">...</span>
                front_right <span id="front_right">...</span>
                right  <span id="right">...</span>
            </div>
            <div>Follow Line <input type="checkbox" id="followline"> </div>
            <div id="allsensors">...</div>
        </div>
    </body>
</html>
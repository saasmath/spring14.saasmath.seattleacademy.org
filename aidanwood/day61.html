<!DOCTYPE html>
<html>
    <head>
        <title>Day 59 | turning balls</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
        <script src="day59.js"></script>
        <script src="utils.js"></script>
	<script src="particle.js"></script>
        <script src="balls.js"></script>
        <!--<script src="onLoad"></script> -->
        
        <style>
            #stage {
                border: solid;
            }
        </style>
        <script>
            $(document).ready(function() {
 
                var canvas;
                var ctx;
               
 
                function init() {
                    canvas = document.getElementById("stage");
                    ctx = canvas.getContext("2d");
                    planet = ball.create(100, 150, 0, 0);
                    draw();
                    endGame();
                }
 
                if(changing == true)
                {
                     balls[0].r = document.form1.size.value; 
                     changing = false;
                }
                
 
                function endGame() {
                    if(balls[0].r >= 450)
                    {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        location.reload();
                        alert('You won!');
                        balls[0].r = 75;
                        
                    }
                }
                function draw() {
                    
                    if(balls.length <= 5)
                    {
                        for(var i = 5; i < 10; i++)
                        {
                            balls[i] = new Array();
                            balls[i].x = Math.floor(Math.random() * (1250 - 50 + 1)) + 50;
                            balls[i].y = Math.floor(Math.random() * (450 - 50 + 1)) + 50;

                            if(i != 0)
                                balls[i].r = Math.floor(Math.random() * ((balls[0].r/2) - (balls[0].r/3) + 1)) + (balls[0].r/3);
                            else
                                balls[i].r = 75;
                            //balls[i].dx = Math.floor(Math.random() * (3 + 3 + 1)) - 3;
                            //balls[i].dy = Math.floor(Math.random() * (3 + 3 + 1)) - 3;

                            if(balls[i].r >= 30 && i != 0) {
                                balls[i].dx = 1;
                                balls[i].dy = 1;
                            }

                            else if(balls[i].r < 30 && i != 0) {
                                balls[i].dx = 2;
                                balls[i].dy = 2;
                            }
                            else if(i == 0) {
                                balls[i].dx = 0;
                                balls[i].dy = 0;
                            }




                            if(balls[i].r >= 30 && i != 0)
                                balls[i].fill = "red";
                            else if(balls[i].r < 30 && i != 0)
                                balls[i].fill = "rgb(0,80,0)";
                            else if(i == 0)
                                balls[i].fill = "blue";

                        }
                    }
                    
                    
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    endGame();
                    
 
                    for (var a = 0; a < balls.length; a++) {
                        if (balls[a].r <= 5) {
                            balls.splice(a, 1);//delete balls with no radius
                            console.log(balls);
                        }
                    }
 
                    for (var a = 0; a < balls.length; a++) {
                        ctx.beginPath();
                        ctx.arc(balls[a].x, balls[a].y, balls[a].r, balls[a].theta, balls[a].theta + Math.PI * 2);
                        if(balls[a].r >= 30 && a != 0)
                        {
                            ctx.fillStyle = "red";
                        }
                        else if (balls[a].r <= 30 && a != 0)
                        {
                            ctx.fillStyle = "rgb(0,80,0)";
                        }
                        else if (a == 0){
                            ctx.fillStyle = "blue";
                        }
                        ctx.fillStyle = balls[a].fill;
                        ctx.fill();
                        ctx.strokeStyle = "#000000";
                        ctx.lineTo(balls[a].x, balls[a].y);
                        ctx.stroke();
                        if (balls[a].x <= balls[a].r)
                            balls[a].dx = Math.abs(balls[a].dx); // bounce ball off of left boundary
                        if (balls[a].y <= balls[a].r)
                            balls[a].dy = Math.abs(balls[a].dy); // bounce ball off of top boundary
                        if (balls[a].x >= canvas.width - balls[a].r)
                            balls[a].dx = -Math.abs(balls[a].dx); // bounce ball off of right boundary
                        if (balls[a].y >= canvas.height - balls[a].r)
                            balls[a].dy = -Math.abs(balls[a].dy); // bounce ball off of bottom boundary
                        balls[a].x += balls[a].dx;
                        balls[a].y += balls[a].dy;
                    }
 
                    for (var a = 0; a < balls.length; a++) {
                        for (var b = 0; b < balls.length; b++) {
                            if (a !== b) { // make sure both balls being tested are not the same
                                var distToBalls = Math.sqrt(Math.pow(balls[a].x - balls[b].x, 2) + Math.pow(balls[a].y - balls[b].y, 2));
                                if (distToBalls <= balls[a].r + balls[b].r) {
                                    var newVel = ballsCollide(a, b);
                                }
                            }
                        }
                    }
                    
 
                    //set velocity and angle
                    for (var a = 0; a < balls.length; a++) {
                        balls[a].theta = Math.atan2(balls[a].dy, balls[a].dx);
                        balls[a].v = Math.sqrt(Math.pow(balls[a].dx, 2) + Math.pow(balls[a].dy, 2));
                    }
                    $('#vel').text(balls[0].v);
                    //draw1(planet, "red");
                    requestAnimationFrame(draw);
                }
 
                function ballsCollide(a, b) {
                    if (balls[a].r <= 0)
                        return;
                    if (balls[b].r <= 0)
                        return;
                    ctx.beginPath();
                    ctx.strokeStyle = "red";
                    ctx.lineWidth = 3;
                    ctx.arc(balls[a].x, balls[a].y, balls[a].r, 0, Math.PI * 2, true);
                    ctx.arc(balls[b].x, balls[b].y, balls[b].r, 0, Math.PI * 2, true);
                    ctx.stroke();
 
                    if (balls[a].r > balls[b].r)
                    {
                        var areaA = Math.PI * balls[a].r * balls[a].r;
                        var areaB = Math.PI * balls[b].r * balls[b].r;
                        
                        areaA += areaB * .08;
                        areaB -= areaB * .08;
                        
                        balls[a].r = Math.sqrt(areaA / Math.PI);
                        balls[b].r = Math.sqrt(areaB / Math.PI);
                    }
 
                    if (balls[b].r > balls[a].r)
                    {
                        var areaA = Math.PI * balls[a].r * balls[a].r;
                        var areaB = Math.PI * balls[b].r * balls[b].r;
                        
                        areaA -= areaA * .08;
                        areaB += areaA * .08;
                        
                        balls[a].r = Math.sqrt(areaA / Math.PI);
                        balls[b].r = Math.sqrt(areaB / Math.PI);
                    }
                    var currentscore = $("#collisions").text();
                    $("#collisions").text(currentscore * 1 + 1);
 
                }
 
                init();
 
                $("body").keydown(function(event) {
                    console.log(event.which);
                    if (event.which === 38) //up-arrow
                    {
                        balls[0].dy += -1;
                    }
                    else if (event.which === 37) //left-arrow
                    {
                        balls[0].dx += -1;
                    }
                    else if (event.which === 39) //right-arrow
                    {
                        balls[0].dx += 1;
                    }
                    else if (event.which === 40) //down-arrow
                    {
                        balls[0].dy += 1;
                    }
                    else if (event.which === 32) //Spacebar
                    {
                        balls[0].dy = 0;
                        balls[0].dx = 0;
                    }
                    else if (event.which === 87) //w
                    {
                        balls[0].dy = (balls[0].v*1+1) * Math.sin(balls[0].theta);
                        balls[0].dx = (balls[0].v*1+1) * Math.cos(balls[0].theta);
                    }
 
                });
                
 
            });
 
        </script>
    </head>
 
    <body>
        <div id="container">
            
            <canvas id="stage" width="1300" height="500">
                Your browser does not support the canvas element.
            </canvas>
            <br>Cheats<br>
            <script>
                function increaseR() {
                    balls[0].r += 5;
                }
                function decreaseR() {
                    balls[0].r -= 5;
                }
                function home() {
                    balls[0].x = 0;
                    balls[0].y = 0;
                }
                function getBig() {
                    balls[0].r = 250;
                }
                function changeS() {
                    changing = true;
                }
            </script>
            <button type="button" onclick="increaseR()">+</button>
            <button type="button" onclick="decreaseR()">-</button>
            <!--<form id="form1">
            Size (radius): <input type="number" name="size">
            <button type="button" onclick="changeS">Submit</button>
            </form>--><br> 
            <button type="button" onclick="home()">Home</button> <br>
            <button type="button" onclick="getBig()"> Get massive</button> <br>
            <button onclick="location.reload()">Reset</button> 
            
        </div>
    </body>
</html>
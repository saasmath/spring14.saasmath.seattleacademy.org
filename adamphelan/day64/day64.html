



<!DOCTYPE html>
<html>
    <head>
        <title>Day 64 | making balls</title>
        <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
        <script src="utils.js"></script>
        <script src="particles.js"></script>
        <input type="radio" name="grp1" id="rCreate" checked>Click will create a new circle.<br>
        <input type="radio" name="grp1" id="rSelect">Click will select an existing circle.<br>
        <input type="radio" name="grp1" id="rMove">Click will move selected circle.<br>
        <canvas id="canvas" width=300 height=300></canvas> 

        <style>
        #stage { 
            border: solid;
            background-image:url('http://www.hdwallpapers.in/walls/fantasy_space-wide.jpg');
            background-position: center;
            background-repeat:no-repeat;

        }
    *   </style>
    <script>
        $(document).ready(function() {



            var min = 10;
            var max = 50;
            var maxdx = 5;
            var mindx = -5;
            var maxdy = 5;
            var mindy = -5;


            rect = {
                x: 300,
                y: 300,
                width: 1000,
                height: 550
            };
            function clamp(value, min, max) {
                return Math.min(Math.max(value, min), max);
            }




            var canvas;
            var ctx;
            var balls = [
                {x: 50, y: 50, r: 40, v: 0, theta: 0, dx: 1, dy: 1.5, fill: 'pink'},
                {x: Math.floor(Math.random() * 1000), y: Math.floor(Math.random() * 500), r: Math.floor(Math.random() * (max - min + 1)) + min, v: 0, theta: 0, dx: 1, dy: 1.8, fill: 'red'},
                {x: Math.floor(Math.random() * 1000), y: Math.floor(Math.random() * 500), r: Math.floor(Math.random() * (max - min + 1)) + min, v: 0, theta: 0, dx: 1, dy: 1.3, fill: 'green'},
                {x: Math.floor(Math.random() * 1000), y: Math.floor(Math.random() * 500), r: Math.floor(Math.random() * (max - min + 1)) + min, v: 0, theta: 0, dx: 1, dy: 1.7, fill: 'blue'},
                {x: Math.floor(Math.random() * 1000), y: Math.floor(Math.random() * 500), r: Math.floor(Math.random() * (max - min + 1)) + min, v: 0, theta: 0, dx: 1, dy: 1.1, fill: 'yellow'},
                {x: 450, y: 250, r: Math.floor(Math.random() * (max - min + 1)) + min, v: 0, theta: 0, dx: -0.5, dy: 3, fill: 'blue'}
            ];
            var canvas = document.getElementById('canvas'), // get canvas element
                    ctx = canvas.getContext('2d'), // get context
                    x, y = 0, // initialize
                    dia = canvas.width,
                    radius = dia * 0.5;

            ctx.translate(0.5, 0.5);                        // to make pixels sharper

            for (; y < dia; y++) {                           // walk x/y grid
                for (x = 0; x < dia; x++) {
                    ctx.fillStyle = getRndColor();          // set random color
                    ctx.fillRect(x, y, 1, 1);               // draw a pixel
                }
            }

// create circle

// removes pixels outside next shape
            ctx.globalCompositeOperation = 'destination-in';
            ctx.arc(radius, radius, radius, 0, 2 * Math.PI);
            ctx.fill();

// reset
            ctx.globalCompositeOperation = 'source-over';

            function getRndColor() {
                var r = 255 * Math.random() | 0,
                        g = 255 * Math.random() | 0,
                        b = 255 * Math.random() | 0;
                return 'rgb(' + r + ',' + g + ',' + b + ')';
            }
            function init() {
                canvas = document.getElementById("stage");
                ctx = canvas.getContext("2d");
                draw();
            }

            function addBall(x, y, r, dx, dy, fill) {
                ball = new Array();
                ball.x = Math.floor(Math.random() * 900);
                ball.y = Math.floor(Math.random() * 500);
                ball.r = Math.floor(Math.random() * (max - min + 1)) + min;
                // ball.dx = Math.floor(Math.random() * (maxdx - mindx + 1)) + min;
                ball.dx = utils.randomInt(mindx, maxdx);
                ball.dy = utils.randomInt(mindy, maxdy);
                ball.fill = fill;
                console.log(ball);
                balls.push(ball);
            }
            function draw() {

                ctx.clearRect(0, 0, canvas.width, canvas.height);


                for (var a = 0; a < balls.length; a++) {
                    if (balls[a].r <= 3) {
                        balls.splice(a, 1);//delete balls with no radius
                        currentscore = $("#points").text();
                        $("#points").text(currentscore * 1 + 1);
                        addBall(100, 100, 20, 1, 1, "pink");
                    }
                }

                for (var a = 0; a < balls.length; a++) {
                    ctx.beginPath();
                    ctx.arc(balls[a].x, balls[a].y, balls[a].r, balls[a].theta, balls[a].theta + Math.PI * 2);
                    ctx.fillStyle = balls[a].fill;
                    ctx.lineWidth = 3;
                    ctx.fill();
                    function randomColor() {
                        return ('#' + Math.floor(Math.random() * 16777215).toString(16));
                    }
                    ctx.lineTo(balls[a].x, balls[a].y);
                    ctx.stroke();
                    if (balls[a].x <= balls[a].r)
                        balls[a].dx = Math.abs(balls[a].dx); // bounce ball off of left boundary
                    if (balls[a].y <= balls[a].r)
                        balls[a].dy = Math.abs(balls[a].dy); // bounce ball off of top boundary
                    if (balls[a].x >= canvas.width - balls[a].r)
                        balls[a].dx = -Math.abs(balls[a].dx); // bounce ball off of right boundary
                    if (balls[a].y >= canvas.height - balls[a].r)
                        balls[a].dy = -Math.abs(balls[a].dy); // bounce ball off of bottom boundary
                    balls[a].x += balls[a].dx;
                    balls[a].y += balls[a].dy;

                }

                for (var a = 0; a < balls.length; a++) {
                    for (var b = 0; b < balls.length; b++) {
                        if (a !== b) { // make sure both balls being tested are not the same
                            var distToBalls = Math.sqrt(Math.pow(balls[a].x - balls[b].x, 2) + Math.pow(balls[a].y - balls[b].y, 2));
                            if (distToBalls <= balls[a].r + balls[b].r) {
                                var newVel = ballsCollide(a, b);
                            }
                        }
                    }
                }

                //set velocity and angle
                for (var a = 0; a < balls.length; a++) {
                    balls[a].theta = Math.atan2(balls[a].dy, balls[a].dx);
                    balls[a].v = Math.sqrt(Math.pow(balls[a].dx, 2) + Math.pow(balls[a].dy, 2));
                }
                var vel = balls[0].v;
                $('#vel').text(balls[0].v.toFixed(2));

                var theta = balls[0].theta;
                $('#theta').text(balls[0].theta.toFixed(2));

                requestAnimationFrame(draw);
            }

            function ballsCollide(a, b) {
                if (balls[a].r <= 0)
                    return;
                if (balls[b].r <= 0)
                    return;


                if (balls[a].r > balls[b].r)
                {
                    var areaA = Math.PI * balls[a].r * balls[a].r;
                    var areaB = Math.PI * balls[b].r * balls[b].r;

                    areaA += areaB * .08;
                    areaB -= areaB * .08;

                    balls[a].r = Math.sqrt(areaA / Math.PI);
                    balls[b].r = Math.sqrt(areaB / Math.PI);
                }

                if (balls[b].r > balls[a].r)
                {
                    var areaA = Math.PI * balls[a].r * balls[a].r;
                    var areaB = Math.PI * balls[b].r * balls[b].r;

                    areaA -= areaA * .5;
                    areaB += areaA * .5;

                    balls[a].r = Math.sqrt(areaA / Math.PI);
                    balls[b].r = Math.sqrt(areaB / Math.PI);
                }

            }

            init();

            $("body").keydown(function(event) {
                console.log(event.which);
                if (event.which === 38) //up-arrow
                {
                    balls[0].dy += -1;
                }
                else if (event.which === 37) //left-arrow
                {
                    balls[0].dx += 1;
                }
                else if (event.which === 39) //right-arrow
                {
                    balls[0].dx += -1;
                }
                else if (event.which === 40) //down-arrow
                {
                    balls[0].dy += 1;
                }
                else if (event.which === 32) //Spacebar
                {
                    balls[0].dy = 0;
                    balls[0].dx = 0;
                }
                else if (event.which === 87) //w
                {
                    balls[0].dy = (balls[0].v * 1 + 1) * Math.sin(balls[0].theta);
                    balls[0].dx = (balls[0].v * 1 + 1) * Math.cos(balls[0].theta);
                }
                else if (event.which === 83)//s 
                {
                    balls[0].dy = (balls[0].v * 1 - 1) * Math.sin(balls[0].theta);
                    balls[0].dx = (balls[0].v * 1 - 1) * Math.cos(balls[0].theta);
                }
                else if (event.which === 65)//a 
                {
                    var newtheta = balls[0].theta * 1 + -15 / 360 * Math.PI;
                    balls[0].dx = balls[0].v * Math.cos(newtheta);
                    balls[0].dy = balls[0].v * Math.sin(newtheta);
                }
                else if (event.which === 68)//d
                {
                    var newtheta = balls[0].theta * 1 + 15 / 360 * Math.PI;
                    balls[0].dx = balls[0].v * Math.cos(newtheta);
                    balls[0].dy = balls[0].v * Math.sin(newtheta);
                }

            });

        });

    </script>

    <div id="container">
        <div class="col-xs-3 text-center">
            <div class="row teamname ">Number of Collisions</div>
            <div class="row score text-center" id="collisions">0</div>
            <div class="row teamname ">Velocity</div>
            <div class="row score text-center" id="vel">0</div>
            <div class="row teamname ">Angle Theta</div>
            <div class="row score text-center" id="theta">0</div>
            <div class="row ">Balls Eaten</div>
            <div class="row text-center" id="points">0</div>
            <button onclick="location.reload()">Reset</button>
            <button onclick="floatTo:left">sphere</button>
        </div>
        <canvas id="stage" width=1000 height=550>
            Your browser does not support the canvas element.
        </canvas>
    </div>
</body>
</html>